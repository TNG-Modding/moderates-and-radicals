namespace = confrontations_xenoist

# xenoist
country_event = {
    id = confrontations_xenoist.1
    hide_window = yes

    is_triggered_only = no

    mean_time_to_happen = { months = 1 }
    trigger = {
        is_variable_set = current_xenoist_support
        is_variable_set = current_ideological_purity

        check_variable = {
            which = current_xenoist_support
            value > current_ideological_purity
        }
    }

    immediate = {
        export_resource_income_to_variable = { 
            resource = xenoist_support 
            variable = current_xenoist_support_income
        }

        # One years income
        multiply_variable = {
            which = current_xenoist_support_income
            value = 36
        }

        add_resource = { 
            xenoist_support = -1
            mult = current_xenoist_support_income 
        }

        export_resource_stockpile_to_variable = { 
            resource = xenoist_militancy
            variable = current_xenoist_militancy
        }

        if = {
            limit = {
                check_variable = {
                    which = current_xenoist_militancy
                    value > 75
                }
            }
            country_event = { id = confrontations_xenoist.40 }
        }	
        else_if = {
            limit = {
                check_variable = {
                    which = current_xenoist_militancy
                    value > 50
                }
            }
            country_event = { id = confrontations_xenoist.30 }
        }
        else_if = {
            limit = {
                check_variable = {
                    which = current_xenoist_militancy
                    value > 25
                }
            }
            country_event = { id = confrontations_xenoist.20 }
        }
        else = {
            country_event = { id = confrontations_xenoist.10 }
        }	
    }
}

# Political debate
country_event = {
    id = confrontations_xenoist.10
    title = confrontations_xenoist.10
    desc = confrontations_xenoist.10.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_assembly_fight
    show_sound = event_factions

    immediate = {
        country_event = { id = confrontations.1 }
    }

    option = {
        name = confrontations_xenoist.10.a

        export_resource_income_to_variable = {
            resource = consumer_goods
            variable = current_monthly_xenoist_consumer_goods_income
        }
        multiply_variable = {
            which = current_monthly_xenoist_consumer_goods_income
            value = 6
        }
        
        add_resource = {
            consumer_goods = 1
            mult = current_monthly_xenoist_consumer_goods_income
        }
        add_modifier = {
            modifier = xenoist_debates_continue_modifier
            years = 3
        }
    }
    option = {
        name = confrontations_xenoist.10.b

        add_modifier = {
            modifier = xenoist_debates_stopped_modifier
            years = 3
        }
    }
}

# Riots
country_event = {
    id = confrontations_xenoist.20
    title = confrontations_xenoist.20
    desc = confrontations_xenoist.20.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_night_raid
    show_sound = event_super_explosion

    immediate = {
        country_event = { id = confrontations.1 }
    }

    option = {
        name = confrontations_xenoist.20.a

        add_modifier = {
            modifier = xenoist_riots_continue_modifier
            years = 3
        }

        random_owned_pop = {
            limit = {
                NOT = { 
                    pop_has_ethic = ethic_xenophile
                }
            }
            pop_change_ethic = ethic_xenophile
        }
    }

    option = {
        name = confrontations_xenoist.20.b

        add_modifier = {
            modifier = xenoist_riots_stopped_modifier
            years = 3
        }
    }
}

# Book Burning
country_event = {
    id = confrontations_xenoist.30
    title = confrontations_xenoist.30
    desc = confrontations_xenoist.30.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_burning_city
    show_sound = event_air_raid_siren

    immediate = {
        country_event = { id = confrontations.1 }
    }

    option = {
        name = confrontations_xenoist.30.a

        add_modifier = {
            modifier = xenoist_violent_riots_continue_modifier
            years = 3
        }
    }
    option = {
        name = confrontations_xenoist.30.b

        add_modifier = {
            modifier = xenoist_violent_riots_stopped_modifier
            years = 3
        }
    }
}

# Coup
country_event = {
    id = confrontations_xenoist.40
    title = confrontations_xenoist.40
    desc = confrontations_xenoist.40.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_open_revolt
    show_sound = event_super_explosion

    immediate = {
        country_event = { id = confrontations.1 }
    }

    option = {
        name = confrontations_xenoist.40.a
        
        if = {
            limit = { 
                NOT = { 
                    has_ethic = "ethic_fanatic_xenophile" 
                } 
            }
            shift_ethic = ethic_xenophile
        }
        
        add_resource = {
            ideological_purity = -25
        }

        add_modifier = {
            modifier = xenoist_coup_continue_modifier
            years = 3
        }

        # Kill ruler
        kill_leader = {
            type = ruler
        }

        # Kill rulers of wrong ethic
        if = {
            limit = {
                count_owned_pop = {
                    count >= 3
                    limit = {
                        NOT = { pop_has_ethic = ethic_xenophile }
                        is_pop_category = ruler
                    }
                }
            }
            random_owned_pop = {
                limit = {
                    NOT = { pop_has_ethic = ethic_xenophile }
                    is_pop_category = ruler
                }
                kill_pop = yes
            }
            random_owned_pop = {
                limit = {
                    NOT = { pop_has_ethic = ethic_xenophile }
                    is_pop_category	= ruler
                }
                kill_pop = yes
            }
            random_owned_pop = {
                limit = {
                    NOT = { pop_has_ethic = ethic_xenophile }
                    is_pop_category	= ruler
                }
                kill_pop = yes
            }
        }
        else = {
            random_owned_pop = {
                limit = {
                    NOT = { pop_has_ethic = ethic_xenophile }
                    is_pop_category	= ruler
                }
                kill_pop = yes
            }
            random_owned_pop = {
                limit = {
                    NOT = { pop_has_ethic = ethic_xenophile }
                    is_pop_category	= ruler
                }
                kill_pop = yes
            }
        }
        

        # Convert pops

        # Inform others
        # every_relation = {
        #     limit = {
        #         is_ai = no
        #         is_country_type = default
        #         has_communications = prev
        #         has_intel_level = {
        #             who = prev
        #             category = government
        #             level >= 1
        #         }
        #     }
        #     country_event = { id = factions.2000 }
        # }        
    }
}