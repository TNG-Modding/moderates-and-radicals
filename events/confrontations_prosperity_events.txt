namespace = confrontations_prosperity

# Prosperity Confrontations

# Calculating which confrontation to use
country_event = {
    id = confrontations_prosperity.1
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_modifier = recent_political_event }
        has_modifier = politics

        check_variable = {
            which = current_prosperity_support
            value > current_ideological_purity
        }
    }

    immediate = {
        export_resource_stockpile_to_variable = { 
            resource = prosperity_militancy_current_value
            variable = current_prosperity_militancy
        }
        every_pop_faction = {
            limit = {
                OR = {
                    is_pop_faction_type = gov_prosperity
                    is_pop_faction_type = prosperity_radicals
                    is_pop_faction_type = prosperity
                }
            }
            if = {
                limit = {
                    owner = { 
                        check_variable = {
                            which = current_imperialist_militancy
                            value > 90
                        } 
                    }
                }
                
                random_list = {
                    20 = {
                        # Prosperity Coup
                        pop_faction_event = { id = confrontations_prosperity.90 }
                    }
                    80 = {
                        # Prosperity Putsch
                        pop_faction_event = { id = confrontations_prosperity.91 }
                    }                    
                }                
                
            }	
            else_if = {
                limit = {
                    owner = { 
                        check_variable = {
                            which = current_imperialist_militancy
                            value > 80
                        } 
                    }
                }
                random_list = {
                    0 = {
                        # Ruler Assassinated
                        pop_faction_event = { id = confrontations_prosperity.80 }
                    }
                    50 = {
                        # Faction Leader Assassinated
                        pop_faction_event = { id = confrontations_prosperity.81 }
                    }
                }
            }
            else_if = {
                limit = {
                    owner = { 
                        check_variable = {
                            which = current_imperialist_militancy
                            value > 50
                        } 
                    }
                }
                random_list = {
                    100 = {
                        # Militarist Book Burning
                        pop_faction_event = { id = confrontations_prosperity.30 }
                    }
                }
            }
            else_if = {
                limit = {
                    owner = { 
                        check_variable = {
                            which = current_imperialist_militancy
                            value > 25
                        } 
                    }
                }
                random_list = {
                    100 = {
                        # Prosperity Riots and Endorse Movement
                        pop_faction_event = { id = confrontations_prosperity.20 }
                    }
                }
            }
            else_if = {
                limit = {
                    owner = { 
                        check_variable = {
                            which = current_imperialist_militancy
                            value > 0
                        } 
                    }
                }
                random_list = {
                    100 = {
                        # Pacifist policy wording
                        pop_faction_event = { id = confrontations_prosperity.10 }
                    }
                }
            }	 
            else = {
                # create_message = {
                #     type = BYPASS_EXPLORED
                #     localization = BYPASS_EXPLORED_MESSAGE
                #     days = 30
                #     target = root
                #     variable = { type = name localization = SYSTEM1 scope = from }
                #     variable = { type = name localization = SYSTEM2 scope = fromfrom }
                # }
            }
        }        
    }
}

# Dock prosperity_support
country_event = {
    id = confrontations_prosperity.2
    hide_window = yes

    is_triggered_only = yes

    immediate = {
        add_modifier = {
            modifier = recent_political_event
            months = 3
        }
        export_resource_income_to_variable = { 
            resource = prosperity_support 
            variable = current_prosperity_support_income
        }

        # Three years income
        multiply_variable = {
            which = current_prosperity_support_income
            value = 36
        }

        add_resource = { 
            prosperity_support = -1
            mult = current_prosperity_support_income 
        }
    }
}


# Political debate
pop_faction_event = {
    id = confrontations_prosperity.10
    title = confrontations_prosperity.10
    desc = confrontations_prosperity.10.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_assembly_fight
    show_sound = event_factions

    immediate = {
        owner = { country_event = { id = confrontations_prosperity.2 } }
    }

    option = {
        name = confrontations_prosperity.10.a

        owner = {
            add_monthly_resource_mult = {
                resource = consumer_goods
                value = 6
                max = 1000
                min = 30
            }
            add_modifier = {
                modifier = prosperity_debates_continue_modifier
                years = 3
            }
        }
    }
    option = {
        name = confrontations_prosperity.10.b

        owner = {
            add_modifier = {
                modifier = prosperity_debates_stopped_modifier
                years = 3
            }
        }
    }
}

# Riots
pop_faction_event = {
    id = confrontations_prosperity.20
    title = confrontations_prosperity.20
    desc = confrontations_prosperity.20.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_night_raid
    show_sound = event_super_explosion

    immediate = {
        owner = { country_event = { id = confrontations_prosperity.2 } }
    }

    option = {
        name = confrontations_prosperity.20.a

        owner = {
            add_modifier = {
                modifier = prosperity_riots_continue_modifier
                years = 3
            }

            random_owned_pop = {
                limit = {
                    NOT = { 
                        pop_has_ethic = ethic_pacifist
                    }
                }
                pop_change_ethic = ethic_pacifist
            }
        }
    }

    option = {
        name = confrontations_prosperity.20.b

        owner = {
            add_modifier = {
                modifier = prosperity_riots_stopped_modifier
                years = 3
            }
        }
    }
}

# Book Burning
pop_faction_event = {
    id = confrontations_prosperity.30
    title = confrontations_prosperity.30
    desc = confrontations_prosperity.30.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_burning_city
    show_sound = event_air_raid_siren

    immediate = {
        owner = { country_event = { id = confrontations_prosperity.2 } }
    }

    option = {
        name = confrontations_prosperity.30.a

        owner = {
            add_modifier = {
                modifier = prosperity_violent_riots_continue_modifier
                years = 3
            }
        }
    }
    option = {
        name = confrontations_prosperity.30.b

        owner = {
            add_modifier = {
                modifier = prosperity_violent_riots_stopped_modifier
                years = 3
            }
        }
    }
}

# Ruler assassination
pop_faction_event = {
    id = confrontations_prosperity.80
    title = confrontations_prosperity.80
    desc = confrontations_prosperity.80.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_open_revolt
    show_sound = event_super_explosion

    trigger = {
        owner = {
            count_owned_leader = {
                limit = {
                    leader_class = ruler 
                }
                count > 0
            }
        }        
    }

    immediate = {
        owner = { country_event = { id = confrontations_prosperity.2 } }
    }

    option = {
        name = confrontations_prosperity.80.a
        
        owner = {
            add_resource = {
                ideological_purity_current_value = -25
                prosperity_militancy_current_value = 10
                prosperity_support = 10
            }

            add_modifier = {
                modifier = prosperity_ruler_assassination_continue_modifier
                years = 3
            }

            # Kill ruler
            kill_leader = {
                type = ruler
                show_notification = yes
            }    
        }
    }
}

# Faction assassinated non government faction
pop_faction_event = {
    id = confrontations_prosperity.81
    title = confrontations_prosperity.81
    desc = confrontations_prosperity.81.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_open_revolt
    show_sound = event_super_explosion

    trigger = {
        # Is there a non government faction that is not the same as root
        # This is faction infighting
        owner = {
            count_pop_faction = {
                limit = {
                    NOT = {
                        is_same_value = root
                    }
                    NOR = {
                        is_pop_faction_type = gov_imperialist
                        is_pop_faction_type = gov_supremacist
                        is_pop_faction_type = gov_progressive
                        is_pop_faction_type = gov_technologist
                        is_pop_faction_type = gov_prosperity
                        is_pop_faction_type = gov_xenoist
                        is_pop_faction_type = gov_totalitarian
                        is_pop_faction_type = gov_traditionalist
                    }
                    owner = {
                        count_owned_leader = {
                            limit = {
                                leader_of_faction = prevprev
                            }
                            count = 1
                        }
                    }
                }    
                count > 0            
            }
        }
    }

    immediate = {
        owner = {
            random_pop_faction = {
                limit = {
                    NOT = {
                        is_same_value = root
                    }
                    NOR = {
                        is_pop_faction_type = gov_imperialist
                        is_pop_faction_type = gov_supremacist
                        is_pop_faction_type = gov_progressive
                        is_pop_faction_type = gov_technologist
                        is_pop_faction_type = gov_prosperity
                        is_pop_faction_type = gov_xenoist
                        is_pop_faction_type = gov_totalitarian
                        is_pop_faction_type = gov_traditionalist
                    }
                    owner = {
                        count_owned_leader = {
                            limit = {
                                leader_of_faction = prevprev 
                            }
                            count = 1
                        }
                    }
                }
                save_event_target_as = assassinated_leader_faction

                owner = {
                    every_owned_leader = {
                        limit = {
                            leader_of_faction = event_target:assassinated_leader_faction
                        }
                        save_event_target_as = assassinated_faction_leader
                    }
                }                
            }
            owner = { country_event = { id = confrontations_prosperity.2 } }
        }
        
        event_target:assassinated_faction_leader = {
            kill_leader = {
                show_notification = yes
            }
        }        
    }

    option = {
        name = confrontations_prosperity.81.a
        
        owner = {
            add_resource = {
                ideological_purity_current_value = -25
            }
            if = {
                limit = {
                    event_target:assassinated_leader_faction = {
                        OR = {
                            is_pop_faction_type = imperialist
                            is_pop_faction_type = imperialist_radicals
                        }                        
                    }
                }
                add_resource = {
                    imperialist_militancy_desired_value_change = 10
                    imperialist_support = 10
                }
                add_modifier = {
                    modifier = imperialist_faction_leader_assassination_continue_modifier
                    years = 3
                }
            }
            else_if = {
                limit = {
                    event_target:assassinated_leader_faction = {
                        OR = {
                            is_pop_faction_type = supremacist
                            is_pop_faction_type = supremacist_radicals
                        }                        
                    }
                }
                add_resource = {
                    supremacist_militancy_desired_value_change = 10
                    supremacist_support = 10
                }
                add_modifier = {
                    modifier = supremacist_faction_leader_assassination_continue_modifier
                    years = 3
                }
            }
            else_if = {
                limit = {
                    event_target:assassinated_leader_faction = {
                        OR = {
                            is_pop_faction_type = progressive
                            is_pop_faction_type = progressive_radicals
                        }                        
                    }
                }
                add_resource = {
                    progressive_militancy_desired_value_change = 10
                    progressive_support = 10
                }
                add_modifier = {
                    modifier = progressive_faction_leader_assassination_continue_modifier
                    years = 3
                }
            }
            else_if = {
                limit = {
                    event_target:assassinated_leader_faction = {
                        OR = {
                            is_pop_faction_type = technologist
                            is_pop_faction_type = technologist_radicals
                        }                        
                    }
                }
                add_resource = {
                    technologist_militancy_desired_value_change = 10
                    technologist_support = 10
                }
                add_modifier = {
                    modifier = technologist_faction_leader_assassination_continue_modifier
                    years = 3
                }
            }
            else_if = {
                limit = {
                    event_target:assassinated_leader_faction = {
                        OR = {
                            is_pop_faction_type = prosperity
                            is_pop_faction_type = prosperity_radicals
                        }                        
                    }
                }
                add_resource = {
                    prosperity_militancy_desired_value_change = 10
                    prosperity_support = 10
                }
                add_modifier = {
                    modifier = prosperity_faction_leader_assassination_continue_modifier
                    years = 3
                }
            }
            else_if = {
                limit = {
                    event_target:assassinated_leader_faction = {
                        OR = {
                            is_pop_faction_type = xenoist
                            is_pop_faction_type = xenoist_radicals
                        }                        
                    }
                }
                add_resource = {
                    xenoist_militancy_desired_value_change = 10
                    xenoist_support = 10
                }
                add_modifier = {
                    modifier = xenoist_faction_leader_assassination_continue_modifier
                    years = 3
                }
            }
            else_if = {
                limit = {
                    event_target:assassinated_leader_faction = {
                        OR = {
                            is_pop_faction_type = totalitarian
                            is_pop_faction_type = totalitarian_radicals
                        }                        
                    }
                }
                add_resource = {
                    totalitarian_militancy_desired_value_change = 10
                    totalitarian_support = 10
                }
                add_modifier = {
                    modifier = totalitarian_faction_leader_assassination_continue_modifier
                    years = 3
                }
            }
            else_if = {
                limit = {
                    event_target:assassinated_leader_faction = {
                        OR = {
                            is_pop_faction_type = traditionalist
                            is_pop_faction_type = traditionalist_radicals
                        }                        
                    }
                }
                add_resource = {
                    traditionalist_militancy_desired_value_change = 10
                    traditionalist_support = 10
                }     
                add_modifier = {
                    modifier = traditionalist_faction_leader_assassination_continue_modifier
                    years = 3
                }           
            }
        }
    }
}

# Coup
pop_faction_event = {
    id = confrontations_prosperity.90
    title = confrontations_prosperity.90
    desc = confrontations_prosperity.90.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_open_revolt
    show_sound = event_super_explosion

    immediate = {
        owner = {
            if = {
                limit = { 
                    NOT = { 
                        has_ethic = "ethic_fanatic_pacifist" 
                    } 
                }
                shift_ethic = ethic_pacifist
            }
            kill_leader = {
                type = ruler
            }
            owner = { country_event = { id = confrontations_prosperity.2 } }
        }
    }

    option = {
        name = confrontations_prosperity.90.a
        
        owner = {
            
            add_resource = {
                ideological_purity_current_value = -25
            }

            add_modifier = {
                modifier = prosperity_coup_continue_modifier
                years = 3
            }

            # Kill rulers of wrong ethic
            if = {
                limit = {
                    count_owned_pop = {
                        count >= 3
                        limit = {
                            NOT = { pop_has_ethic = ethic_pacifist }
                            is_pop_category = ruler
                        }
                    }
                }
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_pacifist }
                        is_pop_category = ruler
                    }
                    kill_pop = yes
                }
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_pacifist }
                        is_pop_category	= ruler
                    }
                    kill_pop = yes
                }
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_pacifist }
                        is_pop_category	= ruler
                    }
                    kill_pop = yes
                }
            }
            else = {
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_pacifist }
                        is_pop_category	= ruler
                    }
                    kill_pop = yes
                }
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_pacifist }
                        is_pop_category	= ruler
                    }
                    kill_pop = yes
                }
            }
            
            # Inform others
            # every_relation = {
            #     limit = {
            #         is_ai = no
            #         is_country_type = default
            #         has_communications = prev
            #         has_intel_level = {
            #             who = prev
            #             category = government
            #             level >= 1
            #         }
            #     }
            #     country_event = { id = factions.2000 }
            # }    
        }    
    }
}

# Putsch
pop_faction_event = {
    id = confrontations_prosperity.91
    title = confrontations_prosperity.91
    desc = confrontations_prosperity.91.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_alien_propaganda
    show_sound = event_air_raid_siren

    immediate = {
        owner = {
            # Assign event_target:putsch_leader
            every_owned_leader = {
                limit = {
                    OR = {
                        leader_of_faction = gov_prosperity
                        leader_of_faction = prosperity
                        leader_of_faction = prosperity_radicals
                    }
                }
                save_event_target_as = putsch_leader
            }

            # Kill all leaders who arent the putsch leader
            every_owned_leader = {
                limit = { NOT = { is_same_value = event_target:putsch_leader }}
                kill_leader = { }  
            }

            # Assign event_target:putsch_leader to ruler
            assign_leader = event_target:putsch_leader

            # Governor for each sector
            every_owned_sector = {
                owner = {
                    create_leader = {
                        name = random
                        class = governor
                        skill = 1
                        species = owner_main_species
                        traits = {
                            trait = random_trait
                        }
                        effect = {
                            save_event_target_as = new_governor
                        }                    
                    }
                }
                
                assign_leader = event_target:new_governor
            }     

            # Scientist for every science ship
            every_owned_ship = {
                limit = {
                    is_ship_class = shipclass_science_ship
                }
                owner = {
                    create_leader = {
                        name = random
                        class = scientist
                        skill = 1
                        species = owner_main_species
                        traits = {
                            trait = random_trait
                        }
                        effect = {
                            save_event_target_as = new_science_ship_scientist
                        }                    
                    }
                }           
                fleet = {
                    assign_leader = event_target:new_science_ship_scientist
                }                     
            }
            # Scientist for each category
            create_leader = {
                name = random
                class = scientist
                skill = 1
                species = owner_main_species
                traits = {
                    trait = random_trait
                }
                effect = {
                    save_event_target_as = new_scientist
                }
            }
            create_leader = {
                name = random
                class = scientist
                skill = 1
                species = owner_main_species
                traits = {
                    trait = random_trait
                }
                effect = {
                    save_event_target_as = new_scientist
                }
            }
            create_leader = {
                name = random
                class = scientist
                skill = 1
                species = owner_main_species
                traits = {
                    trait = random_trait
                }
                effect = {
                    save_event_target_as = new_scientist
                }
            }     

            # Create an admiral
            random_owned_fleet = {
                limit = {
                    is_civilian = no
                }
                owner = {
                    create_leader = {
                        name = random
                        class = admiral
                        skill = 1
                        species = owner_main_species
                        traits = {
                            trait = random_trait
                        }
                        
                        effect = {
                            save_event_target_as = new_admiral
                        }
                    }
                }
                
                assign_leader = event_target:new_admiral
            }
        }

        owner = { country_event = { id = confrontations_prosperity.2 } }          
    }

    option = {
        name = confrontations_prosperity.91.a
        
        owner = {
            add_resource = {
                ideological_purity_current_value = -25
            }

            add_modifier = {
                modifier = prosperity_putsch_continue_modifier
                years = 3
            }                   
        }
    }
}