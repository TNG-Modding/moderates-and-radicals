namespace = confrontations_progressive

# progressive
country_event = {
    id = confrontations_progressive.1
    hide_window = yes

    is_triggered_only = no

    mean_time_to_happen = { months = 1 }
    trigger = {
        NOT = {
            has_modifier = recent_political_event
        }
        has_modifier = politics
        is_variable_set = current_progressive_support
        is_variable_set = current_ideological_purity

        check_variable = {
            which = current_progressive_support
            value > current_ideological_purity
        }
    }

    immediate = {
        add_modifier = {
            modifier = recent_political_event
            years = 1
        }
        export_resource_income_to_variable = { 
            resource = progressive_support 
            variable = current_progressive_support_income
        }

        # One years income
        multiply_variable = {
            which = current_progressive_support_income
            value = 36
        }

        add_resource = { 
            progressive_support = -1
            mult = current_progressive_support_income 
        }

        export_resource_stockpile_to_variable = { 
            resource = progressive_militancy
            variable = current_progressive_militancy
        }

        if = {
            limit = {
                check_variable = {
                    which = current_progressive_militancy
                    value > 90
                }
            }
            every_pop_faction = {
                limit = {
                    OR = {
                        is_pop_faction_type = gov_progressive
                        is_pop_faction_type = progressive_radicals
                        is_pop_faction_type = progressive
                    }
                }
                random_list = {
                    100 = {
                        pop_faction_event = { id = confrontations_progressive.90 }
                    }
                    
                }
                
            }
        }	
        else_if = {
            limit = {
                check_variable = {
                    which = current_progressive_militancy
                    value > 80
                }
            }
            every_pop_faction = {
                limit = {
                    OR = {
                        is_pop_faction_type = gov_progressive
                        is_pop_faction_type = progressive_radicals
                        is_pop_faction_type = progressive
                    }
                }
                random_list = {
                    100 = {
                        pop_faction_event = { id = confrontations_progressive.80 }
                    }
                }
            }
        }
        else_if = {
            limit = {
                check_variable = {
                    which = current_progressive_militancy
                    value > 50
                }
            }
            every_pop_faction = {
                limit = {
                    OR = {
                        is_pop_faction_type = gov_progressive
                        is_pop_faction_type = progressive_radicals
                        is_pop_faction_type = progressive
                    }
                }
                random_list = {
                    100 = {
                        pop_faction_event = { id = confrontations_progressive.30 }
                    }
                }
            }
        }
        else_if = {
            limit = {
                check_variable = {
                    which = current_progressive_militancy
                    value > 25
                }
            }
            every_pop_faction = {
                limit = {
                    OR = {
                        is_pop_faction_type = gov_progressive
                        is_pop_faction_type = progressive_radicals
                        is_pop_faction_type = progressive
                    }
                }
                random_list = {
                    100 = {
                        pop_faction_event = { id = confrontations_progressive.20 }
                    }
                }
            }
        }
        else = {
            every_pop_faction = {
                limit = {
                    OR = {
                        is_pop_faction_type = gov_progressive
                        is_pop_faction_type = progressive_radicals
                        is_pop_faction_type = progressive
                    }
                }
                random_list = {
                    100 = {
                        pop_faction_event = { id = confrontations_progressive.10 }
                    }
                }
            }
        }	 
    }
}


# Political debate
pop_faction_event = {
    id = confrontations_progressive.10
    title = confrontations_progressive.10
    desc = confrontations_progressive.10.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_assembly_fight
    show_sound = event_factions

    immediate = {
        owner = { country_event = { id = confrontations.1 } }
    }

    option = {
        name = confrontations_progressive.10.a

        owner = {
            export_resource_income_to_variable = {
                resource = consumer_goods
                variable = current_monthly_progressive_consumer_goods_income
            }
            multiply_variable = {
                which = current_monthly_progressive_consumer_goods_income
                value = 6
            }
            
            add_resource = {
                consumer_goods = 1
                mult = current_monthly_progressive_consumer_goods_income
            }
            add_modifier = {
                modifier = progressive_debates_continue_modifier
                years = 3
            }
        }
    }
    option = {
        name = confrontations_progressive.10.b

        owner = {
            add_modifier = {
                modifier = progressive_debates_stopped_modifier
                years = 3
            }
        }
    }
}

# Riots
pop_faction_event = {
    id = confrontations_progressive.20
    title = confrontations_progressive.20
    desc = confrontations_progressive.20.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_night_raid
    show_sound = event_super_explosion

    immediate = {
        owner = { country_event = { id = confrontations.1 } }
    }

    option = {
        name = confrontations_progressive.20.a

        owner = {
            add_modifier = {
                modifier = progressive_riots_continue_modifier
                years = 3
            }

            random_owned_pop = {
                limit = {
                    NOT = { 
                        pop_has_ethic = ethic_egalitarian
                    }
                }
                pop_change_ethic = ethic_egalitarian
            }
        }
    }

    option = {
        name = confrontations_progressive.20.b

        owner = {
            add_modifier = {
                modifier = progressive_riots_stopped_modifier
                years = 3
            }
        }
    }
}

# Book Burning
pop_faction_event = {
    id = confrontations_progressive.30
    title = confrontations_progressive.30
    desc = confrontations_progressive.30.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_burning_city
    show_sound = event_air_raid_siren

    immediate = {
        owner = { country_event = { id = confrontations.1 } }
    }

    option = {
        name = confrontations_progressive.30.a

        owner = {
            add_modifier = {
                modifier = progressive_violent_riots_continue_modifier
                years = 3
            }
        }
    }
    option = {
        name = confrontations_progressive.30.b

        owner = {
            add_modifier = {
                modifier = progressive_violent_riots_stopped_modifier
                years = 3
            }
        }
    }
}

# Ruler assassination
pop_faction_event = {
    id = confrontations_progressive.80
    title = confrontations_progressive.80
    desc = confrontations_progressive.80.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_open_revolt
    show_sound = event_super_explosion

    immediate = {
        owner = { country_event = { id = confrontations.1 } }
    }

    option = {
        name = confrontations_progressive.80.a
        
        owner = {
            add_resource = {
                ideological_purity = -25
                progressive_militancy = 10
                progressive_support = 10
            }

            add_modifier = {
                modifier = progressive_ruler_assassination_continue_modifier
                years = 3
            }

            # Kill ruler
            kill_leader = {
                type = ruler
            }    
        }
    }
}

# Coup
pop_faction_event = {
    id = confrontations_progressive.90
    title = confrontations_progressive.90
    desc = confrontations_progressive.90.desc
    hide_window = no

    is_triggered_only = yes

    picture = GFX_evt_open_revolt
    show_sound = event_super_explosion

    immediate = {
        owner = { country_event = { id = confrontations.1 } }
    }

    option = {
        name = confrontations_progressive.90.a
        
        owner = {
            if = {
                limit = { 
                    NOT = { 
                        has_ethic = "ethic_fanatic_egalitarian" 
                    } 
                }
                shift_ethic = ethic_egalitarian
            }
            
            add_resource = {
                ideological_purity = -25
            }

            add_modifier = {
                modifier = progressive_coup_continue_modifier
                years = 3
            }

            # Kill ruler
            kill_leader = {
                type = ruler
            }

            # Kill rulers of wrong ethic
            if = {
                limit = {
                    count_owned_pop = {
                        count >= 3
                        limit = {
                            NOT = { pop_has_ethic = ethic_egalitarian }
                            is_pop_category = ruler
                        }
                    }
                }
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_egalitarian }
                        is_pop_category = ruler
                    }
                    kill_pop = yes
                }
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_egalitarian }
                        is_pop_category	= ruler
                    }
                    kill_pop = yes
                }
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_egalitarian }
                        is_pop_category	= ruler
                    }
                    kill_pop = yes
                }
            }
            else = {
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_egalitarian }
                        is_pop_category	= ruler
                    }
                    kill_pop = yes
                }
                random_owned_pop = {
                    limit = {
                        NOT = { pop_has_ethic = ethic_egalitarian }
                        is_pop_category	= ruler
                    }
                    kill_pop = yes
                }
            }
            

            # Convert pops

            # Inform others
            # every_relation = {
            #     limit = {
            #         is_ai = no
            #         is_country_type = default
            #         has_communications = prev
            #         has_intel_level = {
            #             who = prev
            #             category = government
            #             level >= 1
            #         }
            #     }
            #     country_event = { id = factions.2000 }
            # }    
        }    
    }
}